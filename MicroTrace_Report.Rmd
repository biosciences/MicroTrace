---
title: "MicroTrace Outbreak Clustering Report"
author: "Kaitao Lai"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(ggplot2)
library(dplyr)
```

# 1. Introduction

This report summarizes the clustering of pathogen whole-genome sequencing samples using MicroTrace. Clustering is based on pairwise SNP distances. This enables identification of genetically related isolates, aiding outbreak detection and infection control.

# 2. Input Data

We read in the cluster assignments produced by MicroTrace, which include optional metadata (collection date, ward, etc.).

```{r load-data}
clusters <- read_csv("data/cluster_assignments.csv")
head(clusters)
```

# 3. Cluster Summary Statistics

We summarize how many samples fall into each SNP-defined cluster, and display the distribution of collection dates and hospital wards for each cluster.

```{r cluster-summary}
summary_table <- clusters %>%
  group_by(Cluster) %>%
  summarise(
    n_samples = n(),
    wards = paste(unique(Ward), collapse = ", "),
    dates = paste(min(Collection_Date), max(Collection_Date), sep = " to ")
  )
summary_table
```

# 4. SNP Distance Distribution

## 4.1 Histogram

```{r hist, echo=FALSE, out.width="100%"}
knitr::include_graphics("docs/snp_distance_histogram.png")
```

## 4.2 Density Plot
```{r density, echo=FALSE, outwidth="100%"}
knitr::include_graphics("docs/snp_distance_density.png")
```

# 5. Dendrogram

The following dendrogram was generated by MicroTrace. Red dashed lines indicate the SNP threshold used to define clusters.

```{r dendrogram, echo=FALSE, out.width="100%"}
knitr::include_graphics("docs/example_dendrogram.png")
```

# 6. Intra-cluster SNP Distance Summary

We summarize the intra-cluster SNP distances for each cluster, including mean, standard deviation, and min/max distances.

```{r intra-stats}
intra_stats <- read_csv("data/intra_cluster_stats.csv")
intra_stats
```

# 7. Conclusion

MicroTrace enables rapid and reproducible outbreak cluster detection from SNP distance matrices. This HTML report provides a clear summary of potential outbreak groupings, supporting infection prevention and genomic epidemiology workflows.
